name       : mongosh
version    : 1.0.4
release    : 1
source     :
    - https://github.com/mongodb-js/mongosh/archive/refs/tags/v1.0.4.tar.gz : 3a2fe932f6349fdf7560c2099e5f97db4db4133bff4579a100a8f4fe0e83af46
    # git|https://github.com/mongodb-js/mongosh : v1.0.4
homepage   : https://docs.mongodb.com/mongodb-shell/
license    : Apache-2.0
component  : database
summary    : The MongoDB Shell Interpreter
description: |
    The MongoDB Shell, mongosh, is a fully functional JavaScript and Node.js 14.x REPL environment for interacting with MongoDB deployments.
networking : yes
builddeps  :
    - pkgconfig(krb5)
    - pkgconfig(libuv)
    - git
    - nodejs-devel
    - yarn
rundeps    :
    - nodejs
setup      : |
    sed -i "/electron-notarize/d" package.json
    %patch -p1 < $pkgfiles/dont-effing-use-the-damned-notarize.patch
    %patch -p1 < $pkgfiles/build-pull-your-dump-together.patch
    rm packages/build/src/packaging/macos-sign*
build      : |
    yarn
    yarn run bootstrap
    yarn run compile-cli
    yarn install --production
install    : |
    install -dm00755 $installdir/usr/bin
    install -dm00755 $installdir/usr/lib/node_modules/mongosh
    cp -R packages node_modules package*.json $installdir/usr/lib/node_modules/mongosh
    ln -s /usr/lib/node_modules/mongosh/packages/cli-repl/bin/mongosh.js $installdir/usr/bin/mongosh
